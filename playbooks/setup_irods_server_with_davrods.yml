- hosts: all
  become: true
  tasks:
    - include: tasks/install_irods.yml

    - name: Copy container setup onto host (sychronize preserves file permissions)
      ansible.posix.synchronize:
        src: ../files/irods-davrods-server/
        dest: /davrods
        recursive: yes

    - name: Build and start container
      community.docker.docker_compose:
        project_src: /davrods
        state: present
        build: yes
      register: output

    # - name: Debug startup logs
    #   command: docker logs irods_irods_1
    #   register: logoutput

    # - name: debug
    #   debug: var=logoutput

    - name: "Check 'Build and start container'"
      ansible.builtin.assert:
        that:
          - "output.services.davrods.davrods_davrods_1.state.running"
